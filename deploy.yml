- name: Wait for systems to boot up and cloud-init to complete
  hosts: all
  gather_facts: no
  any_errors_fatal: true
  tasks:
    - name: Wait up to 300 seconds
      wait_for_connection:
        delay: 3
        sleep: 5
        timeout: 300

    - name: Gather all facts of cloud init
      cloud_init_data_facts:
      register: result

    - name: Wait for cloud init to finish
      cloud_init_data_facts:
        filter: status
      register: res
      until: "res.cloud_init_data_facts.status.v1.stage is defined and not res.cloud_init_data_facts.status.v1.stage"
      retries: 50
      delay: 5

# Kafka
# Ref. https://github.com/confluentinc/cp-ansible/blob/7.3.4-post/docs/hosts_example.yml
- name: Deploy Confluent Kafka
  hosts: all
  vars:
    installation_method: archive
    redhat_java_package_name: java-11-openjdk
    confluent_archive_file_source: http://dhcp01.isvlab.vmware.com/files/confluent/7.6/confluent-community-7.6.1.tar.gz
    confluent_package_version: 7.6.1
  tasks:
    - name: install confluent Kafka
      confluent.platform.all:
